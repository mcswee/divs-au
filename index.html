<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>divs.au | Australian historical electoral division data</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <style>
        /* 1. RESET & BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden; /* Keeps the app-frame solid */
            font-family: 'Inter', sans-serif; 
            color: #333;
            /* This makes Inter look even smoother on modern screens */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 2. THE HEADER */
        #main-header {
            height: 70px;
            background: #036;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            position: relative;
            color: #f0f0f0;
            z-index: 1001; /* Must be higher than Leaflet's z-index */
        }

        .brand-container {
            display: flex;
            align-items: center;
        }

        .brand-link {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: inherit;
        }

        .header-logo {
            height: 45px;
            width: 45px;
            margin-right: 15px;
            border-radius: 4px;
        }

        .text-group {
            display: flex;
            flex-direction: column;
        }

        .site-title {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1;
            letter-spacing: -0.02px;
        }

        .site-subtitle {
            font-size: 0.85rem;
            color: #fafafa;
            margin-top: 2px;
            font-weight: 400;
            letter-spacing: 0.01em;
        }

        .nav-link {
            text-decoration: none;
            color: #f8f8f8;
            font-weight: 500;
            font-size: 0.95rem;
            padding: 10px 16px;
            border-radius: 6px;
            transition: background 0.2s;
            border: 1px solid transparent;
        }

        .nav-link:hover {
            background: #f5f5f5;
            color: #336;
            border-color: #ddd;
        }

        /* 3. THE VIEWPORT (THE GAP) */
        #app-viewport {
            height: calc(100vh - 105px); /* Header (70px) + Footer (35px) */
            width: 100%;
            position: relative;
            background: #f0f0f0;
        }

        #map {
            height: 100%;
            width: 100%;
            z-index: 1;
        }

        /* 4. THE FOOTER */
#main-footer {
    height: 35px;
    background: #999;
    border-top: 1px solid #777;
    display: flex;
    align-items: center;
    padding: 0 20px;
}

.footer-list {
    list-style: none;
    display: flex;
    align-items: center;
    gap: 15px; /* Space between items */
    margin: 0;
    padding: 0;
    font-size: 0.75rem;
    color: #eee; /* Off-white for the copyright text */
}

.footer-list li {
    display: flex;
    align-items: center;
}

/* Add a small separator between the list items, but not after the last one */
.footer-list li:not(:last-child)::after {
    content: "â€¢";
    margin-left: 15px;
    color: #ccc;
    font-size: 0.6rem;
}

.footer-list a {
    text-decoration: none;
    color: #eee;
    transition: color 0.2s;
}

.footer-list a:hover {
    color: #333;
}

.copyright {
    letter-spacing: 0.05em;
}

/* Legend Styling */
.info.legend {
    padding: 10px;
    background: white;
    background: rgba(255, 255, 255, 0.9);
    line-height: 1.5em;
    border-radius: 5px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
}
.info.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.8;
}

/* Custom Search Box */
#search-container {
    position: absolute;
    top: 10px;
    right: 50px;
    z-index: 1000;
}
#division-search {
    padding: 10px;
    width: 200px;
    border-radius: 4px;
    border: 1px solid #ccc;
}
    </style>
</head>
<body>

    <header id="main-header">
        <div class="brand-container">
            <a href="/" class="brand-link">
                <img src="/star.svg" alt="Logo" class="header-logo">
                <div class="text-group">
                    <h1 class="site-title">divs.au</h1>
                    <span class="site-subtitle">Australian historical electoral division data</span>
                </div>
            </a>
        </div>

        <nav class="nav-container">
            <a href="/divisions" class="nav-link">Reports</a>
        </nav>
    </header>

    <main id="app-viewport">
        <div id="search-container">
            <input type="text" id="division-search" placeholder="Search Division...">
        </div>
        <div id="map"></div>
    </main>

<footer id="main-footer">
    <ul class="footer-list">
        <li class="copyright">&copy; 2025 Darren McSweeney</li>
        <li><a href="/diversions">Side Projects</a></li>
        <li><a href="/divulgence">Disclaimer & Privacy</a></li>
    </ul>
</footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // 1. Initialize the map centered on Australia
        // [lat, lng], zoom level
        var map = L.map('map', {
            zoomControl: true,
            minZoom: 4
        }).setView([-27.00, 133.00], 5);

        // 2. Add the Tile Layer (Carto Positron)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

// 3. Load CSV, then GeoJSON
Papa.parse('2025_results.csv', {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
        const stats = {};
        const parties = {}; // To build the legend automatically

        results.data.forEach(row => {
            if (row.index) {
                const idx = String(row.index).trim();
                stats[idx] = row;
                // Grab party names and colors for the legend
                if (row.party && row.colour) {
                    parties[row.party] = row.colour;
                }
            }
        });

        fetch('2025_electoral_divisions.geojson')
            .then(res => res.json())
            .then(geoData => {
                const geoJsonLayer = L.geoJSON(geoData, {
                    style: (feature) => {
                        const row = stats[String(feature.properties.Index).trim()];
                        return {
                            fillColor: row ? row.colour : '#888',
                            weight: 1,
                            color: 'white',
                            fillOpacity: 0.6 // Slightly more transparent by default
                        };
                    },
onEachFeature: (feature, layer) => {
    const lookupKey = String(feature.properties.Index).trim();
    const row = stats[lookupKey];
    
    if (row) {
        const popupContent = `
            <div style="border-top: 5px solid ${row.colour}; padding: 5px;">
                <h3 style="margin: 0 0 5px 0; color: #333;">${row.division}</h3>
                <div style="margin-bottom: 5px;">
                    <strong>${row.name} ${row.surname}</strong> 
                    <span style="color: #666;">(${row.party})</span>
                </div>
                <div style="font-size: 0.9em; border-top: 1px solid #eee; pt: 5px;">
                    ${row.note ? `<em>Note: ${row.note}</em>` : ''}
                </div>
            </div>
        `;
        layer.bindPopup(popupContent);
    }
}

                        // 2. Click Popup (The full data)
                        if (row) {
                            const popupContent = `
                                <div style="border-top: 10px solid ${row.colour}; padding-top: 5px;">
                                    <h3 style="margin:0;">${row.division}</h3>
                                    <strong>${row.name} ${row.surname}</strong> (${row.party})<br>
                                    <hr>
                                    <small>${row.note || ''}</small>
                                </div>
                            `;
                            layer.bindPopup(popupContent);
                        }

                        // 3. Mouseover/Out Interaction
                        layer.on({
                            mouseover: (e) => {
                                const l = e.target;
                                l.setStyle({ fillOpacity: 0.9, weight: 2 });
                            },
                            mouseout: (e) => {
                                geoJsonLayer.resetStyle(e.target);
                            }
                        });
                    }
                }).addTo(map);

                // --- LEGEND LOGIC ---
                const legend = L.control({position: 'bottomright'});
                legend.onAdd = function () {
                    const div = L.DomUtil.create('div', 'info legend');
                    div.innerHTML = '<strong>Parties</strong><br>';
                    for (let p in parties) {
                        div.innerHTML += `<i style="background:${parties[p]}"></i> ${p}<br>`;
                    }
                    return div;
                };
                legend.addTo(map);

                // --- SEARCH LOGIC ---
                document.getElementById('division-search').addEventListener('input', function(e) {
                    const val = e.target.value.toLowerCase().trim();
                    if (!val) return; // Don't do anything if the box is empty

                    geoJsonLayer.eachLayer(layer => {
                        // Get the Index from the GeoJSON
                        const geoIndex = String(layer.feature.properties.Index).trim();
                        // Look up the corresponding row in our CSV stats
                        const row = stats[geoIndex];

                        if (row && row.division.toLowerCase().includes(val)) {
                            // Optional: You can make it snap only on exact match or partial
                            // For now, let's just snap to the first one that matches
                            map.fitBounds(layer.getBounds());
                            layer.openPopup();
                        }
                    });
                });
            });
    }
});
    </script>
</body>
</html>
